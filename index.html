<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sam's Music Player</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0a;
            color: white;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }

        .background-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(100px) brightness(0.7) saturate(1.8);
            transform: scale(1.2);
            transition: all 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .background-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                135deg,
                rgba(0, 0, 0, 0.4) 0%,
                rgba(0, 0, 0, 0.6) 50%,
                rgba(0, 0, 0, 0.8) 100%
            );
            transition: background 1.2s ease;
        }

        .player-container {
            max-width: 1400px;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 40px;
            position: relative;
        }

        /* Sección Central - Portada (Más pequeña) */
        .center-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 900px;
        }

        .album-art-main {
            width: 320px; /* Reducido de 380px */
            height: 320px; /* Reducido de 380px */
            border-radius: 18px;
            object-fit: cover;
            box-shadow: 
                0 35px 70px rgba(0, 0, 0, 0.8),
                0 0 0 1px rgba(255, 255, 255, 0.1),
                0 0 90px rgba(255, 255, 255, 0.1);
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            margin-bottom: 30px; /* Reducido de 40px */
            opacity: 1;
            transform: scale(1);
        }

        .album-art-main.fade-out {
            opacity: 0;
            transform: scale(0.95);
        }

        .album-art-main.fade-in {
            opacity: 1;
            transform: scale(1);
        }

        .song-info-center {
            text-align: center;
            margin-bottom: 30px; /* Reducido de 40px */
        }

        .song-title {
            font-size: 2.2rem; /* Reducido de 2.8rem */
            font-weight: 700;
            margin-bottom: 10px; /* Reducido de 12px */
            background: linear-gradient(135deg, #fff 0%, #e0e0e0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.1;
            text-shadow: 0 4px 30px rgba(0, 0, 0, 0.6);
            transition: all 0.6s ease;
        }

        .song-artist {
            font-size: 1.3rem; /* Reducido de 1.6rem */
            font-weight: 500;
            opacity: 0.9;
            color: #d0d0d0;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
            transition: all 0.6s ease;
        }

        /* Sección Inferior - Controles en Línea */
        .bottom-section {
            width: 100%;
            max-width: 1000px;
        }

        .player-controls {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(40px) saturate(1.8);
            border-radius: 20px;
            padding: 20px 35px;
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }

        /* Controles en Línea */
        .controls-line {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 25px;
            width: 100%;
        }

        /* Grupo 1: Controles de Reproducción */
        .playback-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* Grupo 2: Aleatorio + Divider */
        .shuffle-section {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        /* Grupo 3: Barra de Progreso */
        .progress-section {
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 200px;
        }

        /* Grupo 4: Controles Secundarios */
        .secondary-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* Divisores */
        .divider {
            width: 1px;
            height: 25px;
            background: linear-gradient(to bottom, 
                transparent 0%, 
                rgba(255, 255, 255, 0.3) 50%, 
                transparent 100%);
        }

        /* Barra de Progreso Delgada */
        .progress-container {
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 160px;
        }

        .time-display {
            font-family: 'Inter', monospace;
            font-size: 11px;
            font-weight: 600;
            opacity: 0.8;
            min-width: 35px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .progress-bar {
            flex: 1;
            height: 3px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            backdrop-filter: blur(10px);
            min-width: 120px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #fff, #e0e0e0);
            border-radius: 2px;
            width: 0%;
            transition: width 0.1s ease;
            position: relative;
            z-index: 2;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .progress-thumb {
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 3;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
        }

        .progress-bar:hover .progress-thumb {
            opacity: 1;
        }

        /* Botones con Imágenes PNG - Estilos Actualizados */
        .control-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 12px;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            position: relative;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.15);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .control-btn.active {
            filter: brightness(1.3) saturate(1.5);
        }

        /* Tamaños específicos para cada botón - TODOS IGUALES */
        .btn-play {
            width: 55px;
            height: 55px;
        }

        .btn-play.playing {
            animation: pulse-glow 2s infinite;
        }

        .btn-prev,
        .btn-next,
        .btn-shuffle,
        .btn-repeat,
        .btn-favorite,
        .btn-lyrics,
        .btn-volume,
        .btn-playlist {
            width: 42px;
            height: 42px;
        }

        .btn-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: all 0.3s ease;
            filter: invert(1) brightness(2); /* Convierte negro a blanco */
        }

        .control-btn:hover .btn-img {
            transform: scale(1.1);
        }

        .control-btn.active .btn-img {
            filter: invert(1) brightness(2) drop-shadow(0 0 8px rgba(255, 255, 255, 0.6));
        }

        /* Estados especiales de botones */
        .btn-favorite.active .btn-img {
            filter: invert(1) brightness(2) drop-shadow(0 0 12px #ff375f) hue-rotate(300deg);
        }

        .btn-repeat.active .btn-img {
            filter: invert(1) brightness(2) drop-shadow(0 0 12px #00d4aa) hue-rotate(120deg);
        }

        .btn-shuffle.active .btn-img {
            filter: invert(1) brightness(2) drop-shadow(0 0 12px #0095ff) hue-rotate(200deg);
        }

        .btn-lyrics.active .btn-img {
            filter: invert(1) brightness(2) drop-shadow(0 0 12px #ffd700) hue-rotate(50deg);
        }

        @keyframes pulse-glow {
            0% { 
                filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.5));
            }
            50% { 
                filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.8));
            }
            100% { 
                filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.5));
            }
        }

        /* Control de Volumen Oculto */
        .volume-control {
            position: relative;
            display: flex;
            align-items: center;
        }

        .volume-popup {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(30px);
            padding: 15px 10px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            margin-bottom: 10px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .volume-control.active .volume-popup {
            opacity: 1;
            pointer-events: all;
        }

        .volume-slider {
            width: 80px;
            height: 4px;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
            transform: rotate(-90deg);
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
        }

        /* Modal de Playlist */
        .playlist-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(30px);
        }

        .playlist-modal.active {
            display: flex;
            animation: modalAppear 0.4s ease;
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: scale(1.1);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .playlist-modal-content {
            background: rgba(30, 30, 40, 0.95);
            backdrop-filter: blur(50px);
            border-radius: 20px;
            padding: 30px;
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 
                0 35px 70px rgba(0, 0, 0, 0.7),
                0 0 0 1px rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            width: 500px;
        }

        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 18px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .playlist-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            background: linear-gradient(135deg, #fff, #b0b0b0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .playlist-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.8rem;
            cursor: pointer;
            padding: 0;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .playlist-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .playlist-items {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .playlist-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid transparent;
            backdrop-filter: blur(10px);
        }

        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .playlist-item.active {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .playlist-item-cover {
            width: 40px; /* Reducido de 45px */
            height: 40px; /* Reducido de 45px */
            border-radius: 8px;
            object-fit: cover;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .playlist-item-info {
            flex: 1;
        }

        .playlist-item-title {
            font-weight: 600;
            font-size: 12px; /* Reducido de 13px */
            margin-bottom: 2px; /* Reducido de 3px */
        }

        .playlist-item-artist {
            font-size: 10px; /* Reducido de 11px */
            opacity: 0.7;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .player-container {
                padding: 20px;
            }
            
            .album-art-main {
                width: 280px; /* Reducido de 300px */
                height: 280px; /* Reducido de 300px */
            }
            
            .song-title {
                font-size: 1.8rem; /* Reducido de 2.2rem */
            }
            
            .song-artist {
                font-size: 1.1rem; /* Reducido de 1.3rem */
            }
            
            .player-controls {
                padding: 15px 20px;
            }
            
            .controls-line {
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .progress-section {
                order: 3;
                width: 100%;
                justify-content: center;
                margin-top: 10px;
            }
            
            .playlist-modal-content {
                width: 90vw;
                margin: 20px;
                padding: 25px;
            }

            .btn-play {
                width: 50px;
                height: 50px;
            }

            .btn-prev,
            .btn-next,
            .btn-shuffle,
            .btn-repeat,
            .btn-favorite,
            .btn-lyrics,
            .btn-volume,
            .btn-playlist {
                width: 38px;
                height: 38px;
            }
        }

        /* Scrollbar personalizado */
        .playlist-items::-webkit-scrollbar {
            width: 5px;
        }

        .playlist-items::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }

        .playlist-items::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }

        .playlist-items::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <div class="background-container">
        <div class="background-image"></div>
        <div class="background-overlay"></div>
    </div>
    
    <div class="player-container">
        <!-- Sección Central - Portada -->
        <div class="center-section">
            <img class="album-art-main" id="mainAlbum" src="" alt="Album Art">
            <div class="song-info-center">
                <h1 class="song-title" id="songTitle">Afraid</h1>
                <p class="song-artist" id="songArtist">The Neighbourhood</p>
            </div>
        </div>

        <!-- Sección Inferior - Controles en Línea -->
        <div class="bottom-section">
            <div class="player-controls">
                <div class="controls-line">
                    <!-- Grupo 1: Controles de Reproducción -->
                    <div class="playback-controls">
                        <button class="control-btn btn-prev" id="prevBtn" aria-label="Canción anterior">
                            <img src="https://image2url.com/images/1761698013612-62385d1e-9789-42b9-ba80-ebe5e42d4c91.png" alt="Anterior" class="btn-img">
                        </button>

                        <button class="control-btn btn-play" id="playBtn" aria-label="Reproducir">
                            <img src="https://image2url.com/images/1761697941860-0ce481a7-5181-49ab-b30a-332650fbfefd.png" alt="Play" class="btn-img play-icon">
                            <img src="https://image2url.com/images/1761699687492-757df8e7-bb4b-4f63-a7a2-496af93bb6f1.png" alt="Pause" class="btn-img pause-icon hidden">
                        </button>

                        <button class="control-btn btn-next" id="nextBtn" aria-label="Siguiente canción">
                            <img src="https://image2url.com/images/1761698032051-f05c1844-9148-4786-afe7-046a3663328a.png" alt="Siguiente" class="btn-img">
                        </button>
                    </div>

                    <!-- Grupo 2: Aleatorio + Divider -->
                    <div class="shuffle-section">
                        <button class="control-btn btn-shuffle shuffle-btn" id="shuffleBtn" aria-label="Modo aleatorio">
                            <img src="https://image2url.com/images/1761698340716-d4d2082d-2700-43b8-82dd-7b639534a92e.png" alt="Aleatorio" class="btn-img">
                        </button>

                        <div class="divider"></div>
                    </div>

                    <!-- Grupo 3: Barra de Progreso -->
                    <div class="progress-section">
                        <span class="time-display" id="timeCurrent">0:00</span>
                        <div class="progress-bar" id="progressBar">
                            <div class="progress-fill" id="progressFill"></div>
                            <div class="progress-thumb" id="progressThumb"></div>
                        </div>
                        <span class="time-display" id="timeDuration">0:00</span>
                    </div>

                    <!-- Grupo 4: Divider + Controles Secundarios -->
                    <div class="secondary-controls">
                        <div class="divider"></div>

                        <button class="control-btn btn-favorite favorite-btn" id="favoriteBtn" aria-label="Agregar a favoritos">
                            <img src="https://image2url.com/images/1761698056717-ea1b41f0-0d28-4596-b01e-23f5b346dcd0.png" alt="Favorito" class="btn-img">
                        </button>

                        <div class="volume-control" id="volumeControl">
                            <button class="control-btn btn-volume" id="volumeBtn" aria-label="Volumen">
                                <img src="https://image2url.com/images/1761698077475-772b65a4-b45b-4f00-97d5-4fb23a84db98.png" alt="Volumen" class="btn-img">
                            </button>
                            <div class="volume-popup">
                                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.01" value="0.8">
                            </div>
                        </div>

                        <button class="control-btn btn-lyrics lyrics-btn" id="lyricsBtn" aria-label="Letras">
                            <img src="https://image2url.com/images/1761698097576-b0db3e20-4d69-42f1-b8db-50c6fcf4a641.png" alt="Letras" class="btn-img">
                        </button>

                        <button class="control-btn btn-repeat repeat-btn" id="repeatBtn" aria-label="Repetir">
                            <img src="https://image2url.com/images/1761698136044-7c4f8857-066a-4c85-8f88-69df03a8c06e.png" alt="Repetir" class="btn-img">
                        </button>

                        <button class="control-btn btn-playlist" id="playlistBtn" aria-label="Lista de reproducción">
                            <img src="https://image2url.com/images/1761698153757-8ddca429-ee2d-4949-bb55-8a62204b5a6d.png" alt="Playlist" class="btn-img">
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Playlist -->
    <div class="playlist-modal" id="playlistModal">
        <div class="playlist-modal-content">
            <div class="playlist-header">
                <h2>Lista de Reproducción</h2>
                <button class="playlist-close" id="playlistClose">&times;</button>
            </div>
            <div class="playlist-items" id="playlistItems">
                <!-- Los elementos de la playlist se generan dinámicamente -->
            </div>
        </div>
    </div>

    <script>
        // Playlist completa con todas las canciones
        const playlist = [
            {
                title: "Enjoy the Silence",
                artist: "Depeche Mode",
                audio: "https://impossible-brown-ezykgroj5j.edgeone.app/enjoythesilence.mp3",
                cover: "https://i.discogs.com/Z9aNokQ5FYxU41Ht38lgj5cAOF9tod6WDF2giGuKz4g/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTM0NTA5/LTEyOTI2NTgxNzAu/anBlZw.jpeg"
            },
            {
                title: "Black Out Days",
                artist: "Phantogram",
                audio: "https://moaning-beige-io3ss7nolj.edgeone.app/blackoutdays.mp3",
                cover: "https://i.discogs.com/QHzpQpfhvi7I-elSFHqoK8m-E00S6SubEcUT-53gU4o/rs:fit/g:sm/q:90/h:500/w:500/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTU0MTg2/MDItMTQ4MTE1MDc4/Mi0yNjI2LmpwZWc.jpeg"
            },
            {
                title: "The Phantom Of The Opera",
                artist: "Nightwish",
                audio: "https://thephantomoftheopera.edgeone.app/thephantomoftheopera.mp3",
                cover: "https://i.discogs.com/YeRn2FD8gT6mB-B0RF8ajpLTdah-Gmy2T2icWsVrUV0/rs:fit/g:sm/q:90/h:598/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTEwNjMy/NjUtMTU1MzE4MjQ4/OC03ODQ2LmpwZWc.jpeg"
            },
            {
                title: "A Case for Shame",
                artist: "Moby, Cold Specks",
                audio: "https://acaseforshamemoby.edgeone.app/acaseforshamemoby.mp3",
                cover: "https://i.discogs.com/18Q8of3m0noM7Cnwgrus8QPTe06OYsQHwB8Ld_nJPLY/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTQ5NTg2/ODEtMTY2MDg3NTkw/Mi02NDQ3LmpwZWc.jpeg"
            },
            {
                title: "Pretending",
                artist: "HIM",
                audio: "https://pretendinghim.edgeone.app/pretendinghim.mp3",
                cover: "https://i.discogs.com/acbx3FyMM0bKmZjzVzBh6-r2ddZksS5nDFPE6h_pcYs/rs:fit/g:sm/q:90/h:597/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTUwNjc5/Ni0xMzU0MzcxNTg4/LTQ0MzAuanBlZw.jpeg"
            },
            {
                title: "Afraid",
                artist: "The Neighbourhood",
                audio: "https://afraidtn.edgeone.app/afraidtn.mp3",
                cover: "https://i.discogs.com/X3XBD6QSKwo3-Fh0p8jN9XTy1h9HeE7BAGYurOp-MLk/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTQ1MDMz/NDEtMTQyMzk0OTc3/Mi0yNzU4LmpwZWc.jpeg"
            },
            {
                title: "Killing Loneliness",
                artist: "HIM",
                audio: "https://killinglonelinesshim.edgeone.app/killinglonelinesshim.mp3",
                cover: "https://i.discogs.com/pR0vANaJLw1L3qy7WN1YQ7T6lfHJOhroiAjUHxDGToo/rs:fit/g:sm/q:90/h:600/w:594/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTE2NjY4/NDUtMTIzNTU5MzY2/My5qcGVn.jpeg"
            },
            {
                title: "Do I Wanna Know?",
                artist: "Arctic Monkeys",
                audio: "https://doiwannaknowarcticmonkeys.edgeone.app/doiwannaknowarcticmonkeys.mp3",
                cover: "https://i.discogs.com/MohCZfatquytAhecVgsR1eyVULp-kPT7ricg83wi0WE/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTQ5MDQx/NTgtMTM3ODk5NDA1/My03MjEyLmpwZWc.jpeg"
            },
            {
                title: "A Little Death",
                artist: "The Neighbourhood",
                audio: "https://alittledeathtn.edgeone.app/alittledeathtn.mp3",
                cover: "https://i.discogs.com/WGlH_aoKUQ-N7jKvjeucearlWX9z3uh_E5VCTXCRu9A/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTQyMjQ0/NTItMTM1OTAyODY5/Ni01ODg1LmpwZWc.jpeg"
            },
            {
                title: "Why'd You Only Call Me When You're High?",
                artist: "Arctic Monkeys",
                audio: "https://whydtn.edgeone.app/whydtn.mp3",
                cover: "https://i.discogs.com/MohCZfatquytAhecVgsR1eyVULp-kPT7ricg83wi0WE/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTQ5MDQx/NTgtMTM3ODk5NDA1/My03MjEyLmpwZWc.jpeg"
            },
            {
                title: "After Hours",
                artist: "The Weeknd",
                audio: "https://afterhourstheweeknd.edgeone.app/afterhourstheweeknd.mp3",
                cover: "https://i.discogs.com/l2jj21S7ocLV1A11JcXOI4jnLaxXyOTyj9mJdwv4Pns/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTE0OTU4/NTAwLTE3NDU1NDY2/NzktNTgyNC5qcGVn.jpeg"
            },
            {
                title: "Lost in the Fire (feat. The Weeknd)",
                artist: "Gesaffelstein, The Weeknd",
                audio: "https://lostinfiretheweeknd.edgeone.app/lostinfiretheweeknd.mp3",
                cover: "https://www.azlyrics.com/images/albums/662/5a24c08654a936a321f6417dfa95328d.jpg"
            },
            {
                title: "Let It Go",
                artist: "The Neighbourhood",
                audio: "https://letitgotn.edgeone.app/letitgotn.mp3",
                cover: "https://i.discogs.com/X3XBD6QSKwo3-Fh0p8jN9XTy1h9HeE7BAGYurOp-MLk/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTQ1MDMz/NDEtMTQyMzk0OTc3/Mi0yNzU4LmpwZWc.jpeg"
            },
            {
                title: "Reflections",
                artist: "The Neighbourhood",
                audio: "https://reflectionstn.edgeone.app/reflectionstn.mp3",
                cover: "https://i.discogs.com/-Dp5Cpx5yJhMRrRmM4_J97ARxbETffXHsQre3R1dK0o/rs:fit/g:sm/q:90/h:598/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTEyODE5/OTE0LTE1NDI1NzI5/NDAtNDM2Ni5qcGVn.jpeg"
            },
            {
                title: "The Rapture",
                artist: "Exit Calm",
                audio: "https://theraptureexitc.edgeone.app/therapture.mp3",
                cover: "https://i.discogs.com/NBecCjmnE9mXD_fmGY4YRiBKANjyNXaiVvHgbMYkkxU/rs:fit/g:sm/q:90/h:594/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTQ5NDc4/MTUtMTQ5NjEwMDA3/Mi0zMzI2LmpwZWc.jpeg"
            },
            {
                title: "Lost Boys",
                artist: "The 69 Eyes",
                audio: "https://lostboysthe69eyes.edgeone.app/lostboyesthe69eyes.mp3",
                cover: "https://i.discogs.com/hSvkpThOobIwFBYR-REMMvRN74Rjm14uyc1v3Qufw-Y/rs:fit/g:sm/q:90/h:595/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTE3Mjgz/MDItMTI2MzIyNjc2/Ny5qcGVn.jpeg"
            },
            {
                title: "I'm Not In Love",
                artist: "10cc",
                audio: "https://imnotinlove10ccc.edgeone.app/imnotinlove10cc.mp3",
                cover: "https://i.discogs.com/hTDZ-9HojYDsb_FN1CC362dGqCTVJEYXiuYxRmO2o8M/rs:fit/g:sm/q:90/h:600/w:597/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTI2NDM3/MzMtMTI5NDY3MzA4/OC5qcGVn.jpeg"
            },
            {
                title: "Thelema",
                artist: "Øfdream",
                audio: "https://thelemaofdreams.edgeone.app/thelema.mp3",
                cover: "https://tse2.mm.bing.net/th/id/OIP.j1Lwmscm7o2aX9FUyYdn1AAAAA?rs=1&pid=ImgDetMain&o=7&rm=3"
            },
            {
                title: "DLZ",
                artist: "TV On The Radio",
                audio: "https://dlztvradio.edgeone.app/dlztvradio.mp3",
                cover: "https://i.discogs.com/BL_H-khCLnRECC9iDcCAeXD3UpT4Y9yCqm75cTSSC4g/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTE0NzE5/ODYtMTIyNjc0MDAx/My5qcGVn.jpeg"
            },
            {
                title: "Again It's Over",
                artist: "Lacrimas Profundere",
                audio: "https://againitsoverlacrimasprofundere.edgeone.app/againitsoverlacrimasprofundere.mp3",
                cover: "https://i.discogs.com/WQv65PYqY3eiVm4wP-sGpAhrM9QNxPcSENLRh_OflY8/rs:fit/g:sm/q:90/h:588/w:591/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTI3NzE3/ODYtMTMwMDMyMTEw/OC5qcGVn.jpeg"
            },
            {
                title: "Hotel",
                artist: "Montell Fish",
                audio: "https://hotelmontellfish.edgeone.app/hotelmontellfish.mp3",
                cover: "https://i.discogs.com/wrhXRuZDBnnIGIeFrRh7iaQranuy09tAY0h8awGX1Fw/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTMzOTM5/NDI5LTE3NDY5NTY4/MTItNDAxNy5wbmc.jpeg"
            },
            {
                title: "Heartbeat",
                artist: "Childish Gambino",
                audio: "https://heartbeatchildissgambino.edgeone.app/heartbeatchildissgambino.mp3",
                cover: "https://i.discogs.com/KQMPVdgB2LgKj98leHT6h4TcK7bOAF9y1JOUSq5doXI/rs:fit/g:sm/q:90/h:527/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTMyNzk1/NUUtMTMyMzY4OTQx/Ny5qcGVn.jpeg"
            },
            {
                title: "Try Me",
                artist: "The Weeknd",
                audio: "https://static-fuchsia-bnsfafyvqz.edgeone.app/trymetheweeknd.mp3",
                cover: "https://i.discogs.com/xkyAOvmv3VYnQaf3iwbkQ7ejjgH3thyhyYRfQ4RwP-8/rs:fit/g:sm/q:90/h:596/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTE1ODI5/NjcyLTE1OTg3NjMy/ODItODQzNi5qcGVn.jpeg"
            },
            {
                title: "Iris",
                artist: "The Goo Goo Dolls",
                audio: "https://iristhegoooodolls.edgeone.app/iristhegoooodolls.mp3",
                cover: "https://i.discogs.com/cAT7Pq1oQgBjp_0e4IfbTsFniwg708oaNxxW_iZBATo/rs:fit/g:sm/q:90/h:583/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTM5MzIw/OC0xNDY2OTkwODI2/LTk3NDUuanBlZw.jpeg"
            },
            {
                title: "Run To You",
                artist: "Bryan Adams",
                audio: "https://runtoyoubryanadams.edgeone.app/runtoyoubryanadams.mp3",
                cover: "https://i.discogs.com/ebmrW8YlU9pEMkRX4MVXlqBEEQoAo8dR8jTFNGI6i5Q/rs:fit/g:sm/q:90/h:600/w:599/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTMyNTA0/NDAtMTM2MDE5MjAw/Mi04MDQ5LmpwZWc.jpeg"
            },
            {
                title: "My Shit",
                artist: "A Boogie Wit da Hoodie",
                audio: "https://myshht937.edgeone.app/myshht.mp3",
                cover: "https://i.discogs.com/1EvciHgLLABqeS5yGRfWHwhUJ87HfAqLZYhQMh-_rUs/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTg4NzUw/MDAtMTczMzUxMjE5/My04NTUxLmpwZWc.jpeg"
            },
            {
                title: "Hate Bein' Sober",
                artist: "Chief Keef, 50 Cent, Wiz Khalifa",
                audio: "https://hatebein2897.edgeone.app/hatebein.mp3",
                cover: "https://i.discogs.com/G0McalaLCoaz5ggjW5lLAZoroiNuK9wewZBV5m0gXJA/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTIxMzQ5/ODI1LTE2Mzk1MDMy/OTAtOTA4MS5qcGVn.jpeg"
            },
            {
                title: "Digital Bath",
                artist: "Deftones",
                audio: "https://digitalbathdeftones.edgeone.app/digitalbathdeftones.mp3",
                cover: "https://i.discogs.com/t5Zhm4ygXJ8xTdKDXC2UkVpRe0vgT52Nbc3GH5RckB0/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTEzODQ5/MzItMTIxNTA1MjQy/NC5qcGVn.jpeg"
            },
            {
                title: "Second Chance",
                artist: "Digitalism",
                audio: "https://secondchancedigitalism.edgeone.app/secondchancedigitalism.mp3",
                cover: "https://i.discogs.com/GT6zCS6-Io0gKtOwLJ1BKaWHvU6DovLOvqyLn9hkgxY/rs:fit/g:sm/q:90/h:500/w:500/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTcwOTEy/ODctMTQzMzUxNzI5/NS00NTU3LmpwZWc.jpeg"
            },
            {
                title: "Yebba's Heartbreak",
                artist: "Drake, Yebba",
                audio: "https://yebbasheartbreak.edgeone.app/yebbasheartbreak.mp3",
                cover: "https://i.discogs.com/kgLZq-FGG8OGpKrqmX6cXsnBdd0azOqC0fWkqfiyg7U/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTIwMDk5/OTg2LTE2MzU0NTIw/OTYtNDIwNy5qcGVn.jpeg"
            },
            {
                title: "Feeling Good",
                artist: "Michael Bublé",
                audio: "https://feelinggoodmichaelbuble.edgeone.app/feelinggoodmichaelbubl%C3%A9.mp3",
                cover: "https://i.discogs.com/cqnFvWdhRIQBFL2hPVwFbsEeHuJpHYk_JAG5KXeqxtc/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTk2OTk5/NS0xMTg4MTQ4Njc5/LmpwZWc.jpeg"
            },
            {
                title: "Reminder",
                artist: "The Weeknd",
                audio: "https://remindertheweeknd.edgeone.app/remindertheweeknd.mp3",
                cover: "https://i.discogs.com/RHnjjaO97GV4JqEdLVSLdBj6i5LetVLyZCrsg-Odi00/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTk0MTQ3/NzEtMTY0NzI4NjE4/Ny02NDc4LmpwZWc.jpeg"
            },
            {
                title: "Back To Black",
                artist: "Amy Winehouse",
                audio: "https://backtoblacksmywinehouse.edgeone.app/backtoblacksmywinehouse.mp3",
                cover: "https://i.discogs.com/syRCX8NaLwK2SMk8X6TVU_DWc8RRqE4b-tebAQ6kVH4/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTgyNTQz/OC0xNjE3ODE0NDI2/LTU1MjUuanBlZw.jpeg"
            },
            {
                title: "Way down We Go",
                artist: "KALEO",
                audio: "https://waydownwegokaleo.edgeone.app/waydownwegokaleo.mp3",
                cover: "https://i.discogs.com/DX1OpnPDhm8ZeWfSfLhBA3T0XOjEI6LqBqMYreIrVp8/rs:fit/g:sm/q:90/h:518/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTk1NTUx/MDItMTQ4OTY5NzA4/MS03MDQ5LmpwZWc.jpeg"
            },
            {
                title: "Sex, Drugs, Etc.",
                artist: "Beach Weather",
                audio: "https://sdetcbeachweather.edgeone.app/sdetcbeachweather.mp3",
                cover: "https://i.discogs.com/z9FGgQdXaWZ_DdquE0-7sG9A366a1BTGO-28GcnsmG0/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTI2NzYy/MzEyLTE2OTYyNzUw/ODktMzAwMi5qcGVn.jpeg"
            },
            {
                title: "Knee Socks",
                artist: "Arctic Monkeys",
                audio: "https://kneesocksarcticmonkeys.edgeone.app/kneesocksarcticmonkeys.mp3",
                cover: "https://i.discogs.com/MohCZfatquytAhecVgsR1eyVULp-kPT7ricg83wi0WE/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTQ5MDQx/NTgtMTM3ODk5NDA1/My03MjEyLmpwZWc.jpeg"
            },
            {
                title: "Feel So Close - Radio Edit",
                artist: "Calvin Harris",
                audio: "https://feelsoclosech.edgeone.app/feelsoclosech.mp3",
                cover: "https://i.discogs.com/Au1MDvaKV-I3HfrZ8OpoSL8QmDj5lI82QCJvrmrSDEo/rs:fit/g:sm/q:90/h:600/w:600/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTMwODgz/OTYtMTMxNTY2OTAz/OS5qcGVn.jpeg"
            },
            {
                title: "Join me In Death",
                artist: "HIM",
                audio: "https://joinmehim.edgeone.app/joinmehim.mp3",
                cover: "https://www.buenamusica.com/media/fotos/discos/h/him/him_when-love-and-death-embrace.jpg"
            },
            {
                title: "All I Need",
                artist: "Lloyd",
                audio: "https://allineed.edgeone.app/allineed.mp3",
                cover: "https://i1.sndcdn.com/artworks-000085140096-ogafvh-t500x500.jpg"
            }
        ];

        class MusicPlayer {
            constructor() {
                this.currentIndex = 5; // Empezar con "Afraid" (índice 5)
                this.isPlaying = false;
                this.volume = 0.8;
                this.progress = 0;
                this.duration = 0;
                this.currentTime = 0;
                this.isShuffled = false;
                this.isRepeating = false;
                this.audio = new Audio();
                this.audio.volume = this.volume;
                this.audio.loop = false;
                
                this.initializeElements();
                this.loadSavedState();
                this.initializeEventListeners();
                this.updateUI();
            }

            initializeElements() {
                // Elementos de la UI
                this.mainAlbum = document.getElementById('mainAlbum');
                this.songTitle = document.getElementById('songTitle');
                this.songArtist = document.getElementById('songArtist');
                
                // Botones de control
                this.playBtn = document.getElementById('playBtn');
                this.prevBtn = document.getElementById('prevBtn');
                this.nextBtn = document.getElementById('nextBtn');
                this.shuffleBtn = document.getElementById('shuffleBtn');
                this.repeatBtn = document.getElementById('repeatBtn');
                this.favoriteBtn = document.getElementById('favoriteBtn');
                this.lyricsBtn = document.getElementById('lyricsBtn');
                
                // Barra de progreso
                this.progressBar = document.getElementById('progressBar');
                this.progressFill = document.getElementById('progressFill');
                this.progressThumb = document.getElementById('progressThumb');
                this.timeCurrent = document.getElementById('timeCurrent');
                this.timeDuration = document.getElementById('timeDuration');
                
                // Control de volumen
                this.volumeControl = document.getElementById('volumeControl');
                this.volumeBtn = document.getElementById('volumeBtn');
                this.volumeSlider = document.getElementById('volumeSlider');
                
                // Modal de playlist
                this.playlistBtn = document.getElementById('playlistBtn');
                this.playlistModal = document.getElementById('playlistModal');
                this.playlistClose = document.getElementById('playlistClose');
                this.playlistItems = document.getElementById('playlistItems');
                
                // Elementos de fondo
                this.backgroundImage = document.querySelector('.background-image');
                this.backgroundOverlay = document.querySelector('.background-overlay');
            }

            loadSavedState() {
                const savedState = localStorage.getItem('musicPlayerState');
                if (savedState) {
                    const state = JSON.parse(savedState);
                    this.currentIndex = state.currentIndex || 5;
                    this.volume = state.volume || 0.8;
                    this.isShuffled = state.isShuffled || false;
                    this.isRepeating = state.isRepeating || false;
                    this.audio.volume = this.volume;
                    this.audio.loop = this.isRepeating;
                    this.volumeSlider.value = this.volume;
                    
                    if (this.isShuffled) this.shuffleBtn.classList.add('active');
                    if (this.isRepeating) this.repeatBtn.classList.add('active');
                }
            }

            saveState() {
                const state = {
                    currentIndex: this.currentIndex,
                    volume: this.volume,
                    isShuffled: this.isShuffled,
                    isRepeating: this.isRepeating
                };
                localStorage.setItem('musicPlayerState', JSON.stringify(state));
            }

            initializeEventListeners() {
                // Controles de reproducción
                this.playBtn.addEventListener('click', () => this.togglePlay());
                this.prevBtn.addEventListener('click', () => this.previousSong());
                this.nextBtn.addEventListener('click', () => this.nextSong());
                this.shuffleBtn.addEventListener('click', () => this.toggleShuffle());
                this.repeatBtn.addEventListener('click', () => this.toggleRepeat());
                this.favoriteBtn.addEventListener('click', () => this.toggleFavorite());
                this.lyricsBtn.addEventListener('click', () => this.toggleLyrics());

                // Control de volumen
                this.volumeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.volumeControl.classList.toggle('active');
                });

                this.volumeSlider.addEventListener('input', (e) => {
                    this.volume = parseFloat(e.target.value);
                    this.audio.volume = this.volume;
                    this.saveState();
                });

                // Cerrar volumen al hacer click fuera
                document.addEventListener('click', () => {
                    this.volumeControl.classList.remove('active');
                });

                // Barra de progreso
                this.progressBar.addEventListener('click', (e) => this.seek(e));
                this.progressBar.addEventListener('mousedown', (e) => this.startDrag(e));

                // Modal de playlist
                this.playlistBtn.addEventListener('click', () => {
                    this.renderPlaylist();
                    this.playlistModal.classList.add('active');
                });
                this.playlistClose.addEventListener('click', () => this.playlistModal.classList.remove('active'));

                // Eventos de audio
                this.audio.addEventListener('loadedmetadata', () => {
                    this.duration = this.audio.duration;
                    this.updateDurationDisplay();
                });

                this.audio.addEventListener('timeupdate', () => {
                    this.currentTime = this.audio.currentTime;
                    this.progress = (this.currentTime / this.duration) * 100;
                    this.updateProgressDisplay();
                });

                this.audio.addEventListener('ended', () => {
                    if (!this.isRepeating) {
                        this.nextSong();
                    }
                });

                // Teclado
                document.addEventListener('keydown', (e) => this.handleKeyPress(e));

                // Cerrar modal al hacer click fuera
                this.playlistModal.addEventListener('click', (e) => {
                    if (e.target === this.playlistModal) this.playlistModal.classList.remove('active');
                });
            }

            handleKeyPress(e) {
                switch(e.code) {
                    case 'Space':
                        e.preventDefault();
                        this.togglePlay();
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        this.previousSong();
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        this.nextSong();
                        break;
                    case 'KeyS':
                        e.preventDefault();
                        this.toggleShuffle();
                        break;
                    case 'KeyR':
                        e.preventDefault();
                        this.toggleRepeat();
                        break;
                    case 'KeyL':
                        e.preventDefault();
                        this.toggleLyrics();
                        break;
                    case 'KeyV':
                        e.preventDefault();
                        this.volumeControl.classList.toggle('active');
                        break;
                }
            }

            toggleShuffle() {
                this.isShuffled = !this.isShuffled;
                this.shuffleBtn.classList.toggle('active', this.isShuffled);
                this.saveState();
            }

            toggleRepeat() {
                this.isRepeating = !this.isRepeating;
                this.audio.loop = this.isRepeating;
                this.repeatBtn.classList.toggle('active', this.isRepeating);
                this.saveState();
            }

            toggleFavorite() {
                this.favoriteBtn.classList.toggle('active');
            }

            toggleLyrics() {
                this.lyricsBtn.classList.toggle('active');
            }

            async playSong(index) {
                if (index < 0) index = playlist.length - 1;
                if (index >= playlist.length) index = 0;
                
                // Animación de transición
                await this.animateTransition();
                
                this.currentIndex = index;
                const song = playlist[this.currentIndex];
                
                if (this.isPlaying) {
                    this.fadeOut(300).then(() => {
                        this.loadAndPlay(song);
                    });
                } else {
                    this.loadAndPlay(song);
                }
                
                this.updateUI();
                this.saveState();
            }

            async animateTransition() {
                // Fade out de la portada actual
                this.mainAlbum.classList.add('fade-out');
                this.songTitle.style.opacity = '0';
                this.songArtist.style.opacity = '0';
                
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // Fade in de la nueva portada
                this.mainAlbum.classList.remove('fade-out');
                this.mainAlbum.classList.add('fade-in');
                this.songTitle.style.opacity = '1';
                this.songArtist.style.opacity = '1';
                
                await new Promise(resolve => setTimeout(resolve, 300));
                
                this.mainAlbum.classList.remove('fade-in');
            }

            loadAndPlay(song) {
                this.audio.src = song.audio;
                this.audio.load();
                this.audio.volume = 0;
                
                this.audio.addEventListener('canplaythrough', () => {
                    this.fadeIn(300);
                    if (this.isPlaying) {
                        this.audio.play().catch(console.error);
                    }
                }, { once: true });
                
                // Actualizar fondo dinámico con la portada
                this.updateDynamicBackground(song.cover);
            }

            updateDynamicBackground(coverUrl) {
                // Usar la misma portada para el fondo con blur
                this.backgroundImage.style.backgroundImage = `url('${coverUrl}')`;
                this.mainAlbum.src = coverUrl;
            }

            fadeOut(duration = 300) {
                const startVolume = this.audio.volume;
                const stepTime = 50;
                const steps = duration / stepTime;
                const stepDecrease = startVolume / steps;
                
                return new Promise(resolve => {
                    const fadeOutInterval = setInterval(() => {
                        if (this.audio.volume > stepDecrease) {
                            this.audio.volume -= stepDecrease;
                        } else {
                            this.audio.volume = 0;
                            clearInterval(fadeOutInterval);
                            resolve();
                        }
                    }, stepTime);
                });
            }

            fadeIn(duration = 300) {
                const targetVolume = this.volume;
                const stepTime = 50;
                const steps = duration / stepTime;
                const stepIncrease = targetVolume / steps;
                this.audio.volume = 0;
                
                return new Promise(resolve => {
                    const fadeInInterval = setInterval(() => {
                        if (this.audio.volume < targetVolume - stepIncrease) {
                            this.audio.volume += stepIncrease;
                        } else {
                            this.audio.volume = targetVolume;
                            clearInterval(fadeInInterval);
                            resolve();
                        }
                    }, stepTime);
                });
            }

            togglePlay() {
                if (this.isPlaying) {
                    this.pause();
                } else {
                    this.play();
                }
            }

            async play() {
                try {
                    if (!this.audio.src) {
                        const currentSong = playlist[this.currentIndex];
                        this.audio.src = currentSong.audio;
                        this.updateDynamicBackground(currentSong.cover);
                    }
                    
                    await this.audio.play();
                    this.isPlaying = true;
                    this.playBtn.classList.add('playing');
                    this.playBtn.querySelector('.play-icon').classList.add('hidden');
                    this.playBtn.querySelector('.pause-icon').classList.remove('hidden');
                } catch (error) {
                    console.error('Error playing audio:', error);
                }
            }

            pause() {
                this.audio.pause();
                this.isPlaying = false;
                this.playBtn.classList.remove('playing');
                this.playBtn.querySelector('.play-icon').classList.remove('hidden');
                this.playBtn.querySelector('.pause-icon').classList.add('hidden');
            }

            previousSong() {
                this.playSong(this.currentIndex - 1);
            }

            nextSong() {
                if (this.isShuffled) {
                    const randomIndex = Math.floor(Math.random() * playlist.length);
                    this.playSong(randomIndex);
                } else {
                    this.playSong(this.currentIndex + 1);
                }
            }

            updateUI() {
                const song = playlist[this.currentIndex];
                
                this.songTitle.textContent = song.title;
                this.songArtist.textContent = song.artist;
            }

            updateDurationDisplay() {
                this.timeDuration.textContent = this.formatTime(this.duration);
            }

            updateProgressDisplay() {
                this.timeCurrent.textContent = this.formatTime(this.currentTime);
                this.progressFill.style.width = `${this.progress}%`;
                this.progressThumb.style.left = `${this.progress}%`;
            }

            formatTime(seconds) {
                if (isNaN(seconds)) return '0:00';
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }

            seek(e) {
                const rect = this.progressBar.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                this.audio.currentTime = percent * this.duration;
            }

            startDrag(e) {
                e.preventDefault();
                const startX = e.clientX;
                
                const doDrag = (moveEvent) => {
                    const currentX = moveEvent.clientX;
                    const rect = this.progressBar.getBoundingClientRect();
                    const percent = (currentX - rect.left) / rect.width;
                    const newTime = Math.max(0, Math.min(this.duration, percent * this.duration));
                    this.audio.currentTime = newTime;
                };
                
                const stopDrag = () => {
                    document.removeEventListener('mousemove', doDrag);
                    document.removeEventListener('mouseup', stopDrag);
                };
                
                document.addEventListener('mousemove', doDrag);
                document.addEventListener('mouseup', stopDrag);
            }

            renderPlaylist() {
                this.playlistItems.innerHTML = '';
                
                playlist.forEach((song, index) => {
                    const item = document.createElement('div');
                    item.className = `playlist-item ${index === this.currentIndex ? 'active' : ''}`;
                    item.innerHTML = `
                        <img src="${song.cover}" alt="${song.title}" class="playlist-item-cover">
                        <div class="playlist-item-info">
                            <div class="playlist-item-title">${song.title}</div>
                            <div class="playlist-item-artist">${song.artist}</div>
                        </div>
                    `;
                    
                    item.addEventListener('click', () => {
                        this.playSong(index);
                        this.playlistModal.classList.remove('active');
                    });
                    
                    this.playlistItems.appendChild(item);
                });
            }
        }

        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', () => {
            window.musicPlayer = new MusicPlayer();
        });
    </script>
</body>
</html>